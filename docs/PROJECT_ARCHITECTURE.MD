# Arquitetura do Projeto

## PadrÃµes Arquiteturais

Este projeto segue os princÃ­pios de **Clean Architecture** e **Domain-Driven Design (DDD)**.

### Clean Architecture

A Clean Architecture organiza o cÃ³digo em camadas concÃªntricas, onde as dependÃªncias apontam sempre para dentro (em direÃ§Ã£o ao domÃ­nio):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frameworks & Drivers                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  Interface Adapters                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚              Application Layer                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚           Domain Layer                    â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Entities (regras de negÃ³cio)           â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Value Objects                          â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Repository Interfaces                  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Use Cases (orquestraÃ§Ã£o)                     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â€¢ Handlers (HTTP)                                    â”‚  â”‚
â”‚  â”‚  â€¢ Repository Implementations (PostgreSQL)            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â€¢ HTTP Server, Database Driver, External APIs              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Domain-Driven Design (DDD)

Conceitos aplicados neste projeto:

| Conceito         | DescriÃ§Ã£o                                   | Exemplo no Projeto                       |
| ---------------- | ------------------------------------------- | ---------------------------------------- |
| **Entity**       | Objeto com identidade e comportamento       | `User`, `Movie`                          |
| **Value Object** | Objeto imutÃ¡vel definido por seus atributos | `Email`, `Password`                      |
| **Repository**   | AbstraÃ§Ã£o para persistÃªncia                 | `UserRepository`, `MovieRepository`      |
| **Use Case**     | Orquestra operaÃ§Ãµes do domÃ­nio              | `RegisterUseCase`, `GetTopMoviesUseCase` |

### Dependency Inversion Principle

As interfaces dos repositÃ³rios sÃ£o definidas na camada de domÃ­nio (`internal/domain/repository/`), e as implementaÃ§Ãµes concretas ficam na infraestrutura (`internal/infrastructure/postgres/`). Isso permite:

- Testar use cases sem banco de dados (mocks)
- Trocar a implementaÃ§Ã£o de persistÃªncia sem afetar o domÃ­nio
- Manter o domÃ­nio independente de frameworks

---

## Estrutura de Pastas

```
movies/
â”œâ”€â”€ cmd/                          # Entry points da aplicaÃ§Ã£o
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ main.go               # Ponto de entrada HTTP server
â”‚
â”œâ”€â”€ internal/                     # CÃ³digo interno (nÃ£o exportÃ¡vel)
â”‚   â”œâ”€â”€ domain/                   # ğŸ¯ Camada de DomÃ­nio
â”‚   â”‚   â”œâ”€â”€ entity/               # Entidades ricas com comportamento
â”‚   â”‚   â”‚   â”œâ”€â”€ user.go           # Entidade User + regras de negÃ³cio
â”‚   â”‚   â”‚   â”œâ”€â”€ movie.go          # Entidade Movie + comportamentos
â”‚   â”‚   â”‚   â””â”€â”€ mapper.go         # ConversÃ£o entity <-> model
â”‚   â”‚   â”œâ”€â”€ repository/           # Interfaces + erros de domÃ­nio
â”‚   â”‚   â”‚   â”œâ”€â”€ user_repository.go
â”‚   â”‚   â”‚   â”œâ”€â”€ movie_repository.go
â”‚   â”‚   â”‚   â””â”€â”€ errors.go         # Erros centralizados
â”‚   â”‚   â””â”€â”€ valueobject/          # Value Objects imutÃ¡veis
â”‚   â”‚       â”œâ”€â”€ email.go          # Email com validaÃ§Ã£o
â”‚   â”‚       â””â”€â”€ password.go       # Password com hash/verify
â”‚   â”‚
â”‚   â”œâ”€â”€ usecase/                  # ğŸ“‹ Camada de AplicaÃ§Ã£o
â”‚   â”‚   â”œâ”€â”€ account/              # Casos de uso de conta
â”‚   â”‚   â”‚   â”œâ”€â”€ register.go
â”‚   â”‚   â”‚   â”œâ”€â”€ authenticate.go
â”‚   â”‚   â”‚   â”œâ”€â”€ get_favorites.go
â”‚   â”‚   â”‚   â”œâ”€â”€ get_watchlist.go
â”‚   â”‚   â”‚   â””â”€â”€ save_to_collection.go
â”‚   â”‚   â””â”€â”€ movie/                # Casos de uso de filmes
â”‚   â”‚       â”œâ”€â”€ get_top_movies.go
â”‚   â”‚       â”œâ”€â”€ get_random_movies.go
â”‚   â”‚       â”œâ”€â”€ get_movie_by_id.go
â”‚   â”‚       â”œâ”€â”€ search_movies.go
â”‚   â”‚       â””â”€â”€ get_genres.go
â”‚   â”‚
â”‚   â”œâ”€â”€ handler/                  # ğŸŒ Camada de Interface (HTTP)
â”‚   â”‚   â”œâ”€â”€ account_handler.go    # Endpoints de conta
â”‚   â”‚   â””â”€â”€ movie_handler.go      # Endpoints de filmes
â”‚   â”‚
â”‚   â””â”€â”€ infrastructure/           # ğŸ”§ Camada de Infraestrutura
â”‚       â””â”€â”€ postgres/             # ImplementaÃ§Ã£o PostgreSQL
â”‚           â”œâ”€â”€ account_repository.go
â”‚           â””â”€â”€ movie_repository.go
â”‚
â”œâ”€â”€ pkg/                          # Pacotes reutilizÃ¡veis
â”‚   â”œâ”€â”€ logger/                   # Logging
â”‚   â”‚   â””â”€â”€ logger.go
â”‚   â””â”€â”€ token/                    # JWT utilities
â”‚       â”œâ”€â”€ creation.go
â”‚       â””â”€â”€ getsecret.go
â”‚
â”œâ”€â”€ models/                       # DTOs (Data Transfer Objects)
â”‚   â”œâ”€â”€ user.go                   # DTO para API/persistÃªncia
â”‚   â”œâ”€â”€ movie.go
â”‚   â”œâ”€â”€ actor.go
â”‚   â””â”€â”€ genre.go
â”‚
â”œâ”€â”€ database/                     # Scripts de banco de dados
â”‚   â””â”€â”€ import/
â”‚       â”œâ”€â”€ database-dump.sql
â”‚       â””â”€â”€ install.go
â”‚
â”œâ”€â”€ public/                       # Frontend SPA
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ app.js
â”‚   â”œâ”€â”€ styles.css
â”‚   â”œâ”€â”€ components/               # Web Components
â”‚   â””â”€â”€ services/                 # ServiÃ§os frontend
â”‚
â””â”€â”€ docs/                         # DocumentaÃ§Ã£o
```

---

## Diagrama de Arquitetura

```mermaid
graph TD
  subgraph Frontend [Frontend SPA]
    App[App.js]
    Router[Router Service]
    Routes[Routes Definitions]
    API[API Service]

    subgraph Components [Web Components]
      Pages[Page Components]
      Shared[Shared Components]
    end

    UI[HTML/CSS Interface]
  end

  subgraph Backend [Backend - Clean Architecture]
    subgraph Handlers [Interface Layer]
      HTTP[HTTP Handlers]
    end

    subgraph UseCases [Application Layer]
      UC[Use Cases]
    end

    subgraph Domain [Domain Layer]
      Entities[Entities]
      VO[Value Objects]
      RepoInterface[Repository Interfaces]
    end

    subgraph Infra [Infrastructure Layer]
      RepoImpl[PostgreSQL Repositories]
      Logger[Logger]
      Token[JWT Token]
    end
  end

  subgraph Database [Persistence]
    DB[(PostgreSQL)]
  end

  subgraph External [External Resources]
    YouTube[YouTube Videos]
    TMDB[TMDB Images]
  end

  %% Frontend Flow
  App --> Router
  Router --> Routes
  Routes --> Pages
  Pages --> Shared
  Pages --> API
  Shared --> API
  Pages --> UI
  Shared --> UI

  %% Frontend to Backend
  API -- HTTP/JSON --> HTTP
  UI -- Static Assets --> HTTP

  %% Backend Flow (Dependency Direction: Outside â†’ Inside)
  HTTP --> UC
  UC --> Entities
  UC --> VO
  UC --> RepoInterface
  RepoImpl -.implements.-> RepoInterface
  RepoImpl --> DB

  %% Infrastructure
  HTTP --> Logger
  UC --> Logger
  HTTP --> Token

  %% External Resources
  UI --> YouTube
  UI --> TMDB

  %% Styling
  classDef domain fill:#e1f5fe,stroke:#01579b
  classDef application fill:#fff3e0,stroke:#e65100
  classDef interface fill:#f3e5f5,stroke:#4a148c
  classDef infra fill:#e8f5e9,stroke:#1b5e20

  class Entities,VO,RepoInterface domain
  class UC application
  class HTTP interface
  class RepoImpl,Logger,Token infra
```

---

## Fluxo de uma RequisiÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚â”€â”€â”€â–¶â”‚ Handler â”‚â”€â”€â”€â–¶â”‚ UseCase â”‚â”€â”€â”€â–¶â”‚ Entity/  â”‚â”€â”€â”€â–¶â”‚  Repo  â”‚
â”‚  (HTTP)  â”‚    â”‚         â”‚    â”‚         â”‚    â”‚ ValueObj â”‚    â”‚ (impl) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                   â”‚
                                                                   â–¼
                                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
                                                              â”‚   DB   â”‚
                                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Exemplo: Registro de usuÃ¡rio**

1. **Handler** recebe requisiÃ§Ã£o HTTP com `{name, email, password}`
2. **UseCase** (`RegisterUseCase`) Ã© chamado
3. **Value Objects** (`Email`, `Password`) validam e encapsulam os dados
4. **Entity** (`User`) Ã© criada com as regras de negÃ³cio
5. **Repository** (interface) persiste via implementaÃ§Ã£o PostgreSQL
6. **Handler** retorna resposta JSON com JWT

---

## Models vs Entities

| Aspecto           | `models/` (DTOs)              | `internal/domain/entity/` |
| ----------------- | ----------------------------- | ------------------------- |
| **Campos**        | PÃºblicos                      | Privados                  |
| **Comportamento** | Nenhum                        | MÃ©todos de negÃ³cio        |
| **Uso**           | SerializaÃ§Ã£o JSON, Scan do DB | LÃ³gica de domÃ­nio         |
| **Mutabilidade**  | Livre                         | Controlada por mÃ©todos    |

O `mapper.go` converte entre DTOs e Entities quando necessÃ¡rio.
